name: Debug Docker Push

on:
  workflow_dispatch:  # Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Debug Info
      run: |
        echo "ðŸ” Debug Information:"
        echo "DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME != '' && 'SET' || 'NOT SET' }}"
        echo "DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD != '' && 'SET' || 'NOT SET' }}"
        echo "Repository: ${{ github.repository }}"
        echo "SHA: ${{ github.sha }}"
    
    - name: Create minimal files
      run: |
        echo "Creating minimal files..."
        # Dockerfile
        cat > Dockerfile << 'EOF'
        FROM alpine:latest
        CMD echo "Hello from Docker!"
        EOF
        
        # index.js
        cat > index.js << 'EOF'
        console.log("Hello from Node.js");
        EOF
        
        # package.json
        cat > package.json << 'EOF'
        {
          "name": "fullstack-project",
          "version": "1.0.0",
          "main": "index.js"
        }
        EOF
    
    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
    
    - name: Test Docker Hub connection
      run: |
        echo "Testing Docker Hub connection..."
        docker login --username ${{ secrets.DOCKER_USERNAME }} --password-stdin <<< "${{ secrets.DOCKER_PASSWORD }}"
        echo "âœ… Logged in successfully!"
    
    - name: Build test image
      run: |
        echo "Building test image..."
        docker build -t ${{ secrets.DOCKER_USERNAME }}/fullstack-project:test-${{ github.sha::8 }} .
        docker images | grep fullstack-project
    
    - name: Push to Docker Hub
      run: |
        echo "Pushing to Docker Hub..."
        docker push ${{ secrets.DOCKER_USERNAME }}/fullstack-project:test-${{ github.sha::8 }}
        echo "âœ… Image pushed!"
        
        echo "Tags available:"
        docker run --rm appropriate/curl -s "https://hub.docker.com/v2/repositories/${{ secrets.DOCKER_USERNAME }}/fullstack-project/tags/" | python3 -c "import sys,json; data=json.load(sys.stdin); print('\n'.join([tag['name'] for tag in data.get('results', [])]))" 2>/dev/null || echo "No tags found"
